제5장 네트워크 계층 : 목적지에 데이터 전달하기
(Network Layer, IP, Router, IP주소, Subnet, Routing)


	17. 네트워크 계층의 역할
	• 데이터 링크 계층의 이더넷을 이용하여 같은 네트워크 내에 있는 컴퓨터로 통신은 할 수 있으나 다른 네트워크로 전송은 불가.
	• 다른 네트워크에 있는 목적지로 데이터를 전달하기 위해선 네트워크 계층의 기술이 필요.
		○ 데이터링크 계층에선 Ethernet을 기반으로 스위치를 통해 데이터 전송을 하였으나, 같은 네트워크 내에 있는 통신만 가능.
		○ 다른 네트워크로 데이터를 전송하는 방법을 배우는 것이 이 장의 목적. 라우터가 네트워크 간 통신 역할.
	• Router(라우터)
		○ 네트워크 간의 통신을 가능하게 하는 것이 네트워크 계층의 역할이며, 라우터라는 네트워크 장비를 사용.
		○ 이는 데이터의 목적지가 정해지면 해당 목적지까지 어떤 경로로 가는 것이 좋은지를 제시.
		○ 데이터를 보낼 상대가 어디 있는지 알 수 없으면 라우터도 경로를 알려줄 수 없음.
			§ 같은 랜 내에선(동일 네트워크 내) MAC주소를 이용하여 통신할 수 있었으나, 다른 네트워크로 보낼 경우 네트워크를 식별할 수 있는 IP주소가 필요.
		○ IP주소로 목적지를 지정할 뿐만 아니라 데이터를 어떠한 경로로 보낼 것인지도 결정해야함. 이를 Routing(라우팅)이라 함.
		○ 라우터를 이용하여 거리에 관계 없이 다른 네트워크로 데이터를 전송할 수 있음.
		○ 라우터는 라우팅 테이블이 있어서 경로 정보를 등록하고 관리.
	• IP Address
		○ 어떤 네트워크의 어떤 컴퓨터인지 구분할 수 있도록 하는 주소.
	• IP(Internet Protocol)
		○ 네트워크 계층에서 캡슐화하는 과정에서 IP Header를 붙임.
		○ IP헤더 구성 : 
			§ version, Header Length, Service Type, Total Packet Length, ID, Flags, Fragment offset, TTL, Protocol, Header Checksum, Source IP Addr, Dest IP Addr.
		○ 가장 중용한 부분은 Source IP Address, Destination IP Address.
		○ 전송할 데이터에 IP Header가 붙은 것을 IP Packet이라고 정의(비교 : Data Link Layer에서 Ethernet Header과 Ethernet Trailer가 추가된 것을 Frame이라고 정의).

	18. IP주소의 구조
	• 데이터를 다른 네트워크의 목적지로 보내기 위한 주소의 개념.
	• IP주소는 공인 IP Address와 사설 IP Address가 있는데, 공인 IP Address는 ISP로부터 제공.
	• IP주소의 두 가지 종류. Ipv4(32bit)와 IPv6(IPv4의 주소 고갈 문제를 해결하기 위해 128bit 구성의 주소를 고안).
	• IPv4의 주소가 고갈되고 있기 때문에, 인터넷에 직접연결되는 컴퓨터나 라우터에는 공인 IP Address를 할당하고, 회사나 가정의 랜에 있는 컴퓨터에는 사설 IP주소를 할당.
		○ 랜 내부에 있는 모든 컴퓨터에 공인 주소를 할당할 경우 모든 기기에 할당하기 어려움.
		○ 따라서, ISP는 인터넷에 직접 연결된 라우터에만 공인 IP Address를 지정해주고, 랜 내에 있는 컴퓨터엔 랜의 네트워크 관리자가 자유롭게 사설 IP주소를 할당.
			§ 라우터 & 스위치에 할당되는 공인 IP 주소는 있되, 하위 컴퓨터들은 자유롭게 사설 IP 주소를 할당.
		○ 혹은 라우터의 DHCP(Dynamic Host Configuration Protocol)기능을 사용하여 주소를 자동으로 할당.
	• MAC Address와 IP Address의 비교
		○ MAC 주소 : 48bit로 구성이 되어 있으며, 구분하기 쉽도록 16진수로 표현.
			§ 예) AA:BB:CC:DD:EE:FF
		○ IP 주소 : 32bit로 구성이 되어 있으며, 구분하기 쉽도록 10진수로 표현(32자리 비트 수를 8자리 옥텟으로 나누어 10진수 4자리로 끊음).
			§ 예) 255.255.255.0
	• IP Address의 구성 - 네트워크 ID와 호스트 ID
		○ 네트워크 ID : 어떤 네트워크인지 알려줌.
		○ 호스트 ID : 해당 네트워크의 어느 컴퓨터인지 알려줌.
	
	19. IP 주소의 클래스 구조
	• IP주소는 네트워크의 규모에 따라 A~E클래스로 나눠져 있음. IPv4의 경우 32bit인데, 네트워크ID를 크게 만들거나 호스트ID를 작게 만들어서 네트워크 크기를 조정할 수 있음.
		○ A클래스 : 대규모 네트워크 주소,  네트워크ID가 처음 8bit,  HOST ID가 뒤 24bit ,  [net][host][host][host]
		○ B클래스 : 중형 네트워크 주소   ,  네트워크ID가 처음 16bit, HOST ID가 뒤 16bit,  [net][net][host][host]
		○ C클래스 : 소규모 네트워크 주소,  네트워크ID가 처음 24bit, HOST ID가 뒤 8bit  ,  [net][net][net][host]
		○ D클래스 : 멀티캐스트 주소
		○ E클래스 : 연구 및 특수용도 주소
	• 공인 IP주소와 사설 IP주소를 포함한 클래스 범위.
		○ 각각의 클래스 별 지정된 옥텟의 범위가 다름.
		○ A : 1.0.0.0    ~ 127.255.255.255(01111111.255.255.255) - 사설 IP 주소 범위 : 10.0.0.0 ~ 10.255.255.255
		○ B : 128.0.0.0 ~ 191.255.255.255(1011111.255.255.255)  - 사설 IP 주소 범위 : 172.16.0.0 ~ 172.31.255.255
		○ C : 192.0.0.0 ~ 223.255.255.255(1101111.255.255.255)  - 사설 IP 주소 범위 : 192.168.0.0 ~ 192.168.255.255
	
		○ 공인 IP Address의 범위와 사설 IP Address의 범위는 다르므로 참고할 것. 위 사설 범위를 제외한 것이 공인 범위.
		○ 일반적인 가정에서는 C클래스의 사설 IP주소인 192.168.@.@이 사용됨. Terminal을 통해 확인 가능.
	
	20. 네트워크 주소와 브로드캐스트 주소의 구조
	• 컴퓨터에 할당할 수 없는 IP주소인 네트워크 주소와 브로드캐스트 주소에 대한 탐구.
		○ 네트워크 주소와 브로드캐스트 주소는 이미 지정된 값이기 때문에 한 컴퓨터에 할당할 수 없음.
	• 예) C클래스의 IP주소일 경우(HOST ID가 한 개의 옥텟) - 바탕으로 아래 설명.
		○ 네트워크 주소는 HOST ID가 0, 00000000
		○ 브로드캐스트 주소는 HOST ID가 255, 11111111
	• 네트워크 주소는 전체 네트워크에서 작은 네트워크를 식별하는 데 사용.
		○ 즉 HOST ID가 0, 00000000일 경우 해당 IP주소는 그 네트워크 전체를 대표하는 주소가 됨.
		○ 예) 192.168.1.1  192.168.1.2  192.168.1.3  192.168.1.4라는 IP주소를 가진 컴퓨터들은 전부 다 192.168.1.0인 네트워크에 존재함.
	• 브로드캐스트 주소는 네트워크에 있는 컴퓨터나 장비 모두에게 한 번에 데이터를 전송하는 데 사용되는 전용 IP 주소.
		○ Host ID 255로 데이터를 전송하면 네트워크 안에 있는 모든 컴퓨터가 데이터를 수신.
		○ 따라서 전제 네트워크에 데이터를 전송하기 위해선 마지막 HOST ID를 255로 설정하여 전송.
		○ 예) 192.168.1.1  192.168.1.2  192.168.1.3  192.168.1.4라는 IP주소를 가진 컴퓨터들은 192.168.1.255로 데이터를 보냈을 때, 데이터를 수신하게 됨.
	• 결과적으로 네트워크 주소와 브로드캐스트 주소만의 역할이 따로 있으므로, 자신의 IP주소로 설정하면 안됨.

	21. Subnet(서브넷)의 구조
	• Subnetting(서브네팅)은 네트워크를 분할하는 것을 의미.
		○ 예) 클래스A와 같은 대규모 네트워크 주소를 가지는 망 내에서 많은 수의 컴퓨터가 브로드캐스트 패킷을 전송하면 패킷의 전송이 혼잡.\
			§ 네트워크 내 포함되는 주소가 1700만개 가까이 되므로 매우 혼잡.
		○ 이럴 경우 작은 네트워크로 분할하여 브로드캐스트로 전송되는 패킷의 범위를 좁힐 수 있음.
		○ 작은 네트워크를 많이 만들 수 있어서 IP주소를 더 효과적으로 활용. 분할된 작은 네트워크를 subnet(서브넷).
		○ 이렇게 될 경우 기존 클래스A 네트워크가 네트워크ID(8bit)-HOST ID(24bit)으로 구성됐었던 것이, 네트워크ID-Subnet ID-HOST ID로 나눠짐.
			§ HOST ID로 사용되던 비트 수를 Subnet ID의 비트 수로 사용.
	• Subnet Mask(서브넷 마스크)
		○ IP주소를 서브네팅하면 네트워크ID-Subnet ID-Host ID를 구분하기 어려울 때가 있는데, 이를 해결하기 위해 서브넷 마스크를 사용.
		○ 예) IPv4기준(32bit)에서 클래스A는 255.0.0.0 클래스B는 255.255.0.0 클래스C는 255.255.255.0이 서브마스크가 됨.
		○ Prefix 표기법
			§ 서브넷 마스크를 슬래시(/비트 수)로 나타낸 것을 의미.
			§ 예) 255.255.255.0은 /24가 됨.
		○ 예) 클래스C의 IP주소(192.168.1.0)를 서브네팅 할 경우.
			§ 192.168.1.0을 255.255.255.0으로 서브네팅.
			§ 서브네팅을 할 경우 네트워크의 서브넷 마스크는 255.255.255.240이 되는데 240은 11110000 이므로 네트워크ID 28bit중 4bit가 Subnet ID가 됨.

	22. 라우터의 구조
	• 스위치나 허브와 같은 기기는 네트워크를 분할할 수 없음. 따라서 네트워크 분할을 위해 라우터를 사용함. 
	• 예) 라우터를 이용하여 분할된 네트워크에서 컴1이 컴6에 접속할 경우
		○ 컴1이 다른 네트워크에 데이터를 전송하기 위해선 라우터의 IP주소를 설정해야 함. 이는 네트워크의 출입구를 설정하는 것으로서 Default Gateway라 함.
			§ 컴1이 다른 네트워크로 데이터를 보낼 때 어디로 보내야하는지 알 수 없으므로 기본 게이트웨이를 설정.
			§ 따라서 다른 네트워크로 향하는 길을 설정해주는 라우터 주소로 전송 - 기본 게이트웨이는 컴퓨터 설정을 통해 확인 가능.
			§ Default Gateway와 더불어 라우팅(Routing) 기능을 더해야 전송 가능.
	• Routing(라우팅)
		○ 경로 정보를 기반으로 현재의 네트워크에서 다른 네트워크로 최적의 경로를 통해 데이터를 전송.
		○ 라우터 내에 이 경로 정보가 들어 있는 것이 Routing Table.
			§ Routing Table은 자동/수동으로 등록할 수 있음.
			§ 수동 : 소규모 네트워크에 적합, 자동 : 대규모 네트워크에 적합.
			§ 자동으로 등록하는 경우 라우터 간에 경로 정보를 서로 교환하여 라우팅 테이블 정보를 자동 수정(네트워크 관리자의 작업 감소) 
		○ 라이터 간에 라우팅 정보를 교환하기 위한 프로토콜을 라우팅 프로토콜(Routing Protocol)이라고 함.

제6장 전송 계층 : 신뢰할 수 있는 데이터 전송
(전송 계층의 역할, 연결형 통신, 비연결형 통신, TCP/UDP)


	23. 전송 계층의 역할
	• 전송 계층은 목적지에 신뢰할 수 있는 데이터를 전달하기 위해 필요.
	• 물리 계층 + 데이터 링크 계층 + 네트워크 계층의 기능을 모두 종합하면 데이터를 목적지에 전송 가능.
		○ 하지만 전송 도중 데이터가 손상되거나 유실되더라도 처리할 수 있는 방법이 없음.
		○ 전송 계층은 목적지에 신뢰할 수 있는 데이터를 전달하기 위해 필요.
	• 전송 계층 역할 1. 오류를 점검하는 기능
		○ 오류가 발생하면 데이터를 재전송.
		○ 네트워크 계층은 목적지까지 데이터를 전달, 전송 계층에서는 데이터가 제대로 도착하는지 확인.
	• 전송 계층 역할 2. 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별하는 기능
		○ 예를 들어, 홈페이지에 사용될 데이터인데 메일 프로그램으로 전송되면 안됨.

	• 전송 계층의 특징 신뢰성/정확성 & 효율성
		○ 신뢰성/정확성을 위한 연결형 통신
		○ 효율성을 위한 비연결형 통신
	• 연결형 통신(신뢰성/정확성을 바탕으로 하는 통신) - TCP 프로토콜(Transfer Control Protocol) 사용
		○ 상대편의 데이터 수신 가능 여부와 데이터 수신 확인 여부 등을 확인해가며 전송하는 방식.
		○ 신뢰할 수 있고 정확한 데이터 전송이 필요한 애플리케이션의 경우 연결형 통신을 사용.
	• 비연결형 통신(효율성을 바탕을 하는 통신) - UDP 프로토콜(User Datagram Protocol) 사용
		○ 상대편을 확인하지 않고 일방적으로 데이터를 전송하는 방식.
		○ 데이터 일부가 유실되더라도 끊기지 않는 영상 재생이 중요하기 때문에 동영상을 볼 경우 비연결형 통신을 사용.

	24. TCP(Transfer Control Protocol)의 구조
	• TCP Header
		○ 전송 계층에서 TCP로 전송할 때 붙이는 헤더를 TCP헤더라고 하며, 데이터에 TCP 헤더가 붙은 것을 세그먼트(Segment)라고 함.
			§ L3에서 IP Header가 추가된 것을 Packet
			§ L2에서 Ethernet Header + Trailer가 추가된 것을 Frame
		○ TCP헤더에 포함되는 내용 : 출발지 포트 번호, 목적지 포트 번호, 일련번호, 확인응답번호, 헤더 길이, 예약 영역, 코드 비트, 윈도우 크기, Checksum, 긴급 포인터, 옵션
			§ 목적지까지 데이터를 제대로 전송하기 위한 정보를 가지고 있음.
	• 연결형 통신
		○ 데이터 전송 전, 연결이라는 가상의 독점 통신로를 확보해야 함. 통신로가 확보된 뒤 상대방과 데이터 송수신 가능.
			§ TCP헤더 내에 코드 비트 부분(TCP 헤더의 107~112번째 bit부분)은 총 6bit으로 연결의 제어 정보가 기록되는 곳.
			§ 코드 비트의 6자리 [URG] [ACK] [PSH] [RST] [SYN] [FIN]로 구성되어 있으며, 각 역할이 다름. 활성 1, 비활성 0.
			§ 연결을 확립하기 위해선 SYN과 ACK가 필요 - SYN - 연결 요청, ACK - 확인 응답을 의미.
			§ 연결을 해제하기 위해선 FIN과 ACK가 필요 - FIN - 해제 요청, ACK - 확인 응답을 의미.
	• 연결 확립 : 3 - way Handshake
		○ 신뢰성 있는 연결을 위해 데이터를 전송하기 전에 패킷을 세 번 교환.
		○ 컴1에서 컴2로 : SYN 연결 확립 요청 (통신을 하기 위해 컴2의 허가를 받아야 하므로 SYN을 보냄)
		○ 컴2에서 컴1로 : SYN + ACK 연결 확립 요청과 연결 확립 응답 (컴1이 보낸 SYN에 대한 응답 ACK를 보내며, 동시에 컴2도 컴1에게 SYN을 요청)
		○ 컴1에서 컴2로 : ACK 연결 확립 응답 (컴2가 보낸 SYN에 대한 응답 ACK를 보냄)
		○ 코드 비트 6bit 중 000010 010010 010000 을 송수신
	• 연결을 종료하기 위해선 FIN과 ACK를 사용하여 연결 해제(해제하는 과정에선 패킷을 4번 교환).
		○ 컴1에서 컴2로 : FIN 요청
		○ 컴2에서 컴1로 : FIN에 대한 ACK 응답
		○ 컴2에서 컴1로 : FIN 요청
		○ 컴1에서 컴2로 : FIN에 대한 ACK 응답
		○ 코드 비트 6bit 중 000001 010000 000001 010000 을 송수신 

	25. 일련번호와 확인 응답 번호의 구조
	• 3 - way Handshake 이후 데이터 전송에 사용되는 TCP헤더의 일련번호와 확인 응답 번호에 대한 정리.
	• 3 - way Handshake를 한 이후에 실제로 데이터를 보내거나 상대방이 받을 경우에는 TCP 헤더의 일련번호(32bit)와 확인 응답 번호(32bit)를 사용.
	• 일련번호
		○ TCP는 데이터를 분할해서 보내는데, 일련번호는 송신 측에서 수신 측에 이 데이터가 몇 번째인지 알려줌.
		○ 전송된 데이터에 일련번호를 부여하면 수신자는 원래 데이터의 몇 번째 데이터를 받았는지 알 수 있음.
	• 확인 응답 번호
		○ 수신 측이 몇 번째 데이터를 수신했는지 송신 측에 알려주는 역할.
		○ 따라서, 이 번호는 다음 번호의 데이터를 요청하는 데에 사용(수신 측에서 10번째 데이터를 받았다면 11번째 데이터를 송신 측에 요청할 수 있음).
	• 예) 컴1과 컴2 사이의 통신에서 일련번호와 확인 응답 번호의 용도.
		○ 3 - way Handshake로 연결 수립이 이루어질 때, 이번 통신에 사용하는 일련번호 @@@@과 응답 번호인 ####이 결정됨(여기서 각각 3001, 4001로 가정).
		○ 컴1은 컴2로 200byte 데이터를 전송
			§ 컴1에서 컴2로 : 일련번호 3001, 확인 응답 번호 4001 전송
		○ 컴2는 200byte를 수신하고 다음에 수신하고자 하는 데이터 번호를 확인 응답 번호에 넣음. 
			§ 컴2에서 컴1로 : 일련번호 4001, 확인 응답 번호 3201 전송
		○ 컴1은 컴2로 3201부터 200byte의 데이터를 전송
			§ 컴1에서 컴2로 : 일련번호 3201, 확인 응답 번호 4001 전송
		○ 컴2는 200byte를 수신하고 다음에 수신하고자 하는 데이터 번호를 확인 응답 번호에 넣음. 
			§ 컴2에서 컴1로 : 일련번호 4001, 확인 응답 번호 3401 전송
		○ 이 과정을 데이터 전송이 완료될 때까지 반복.
	• 데이터가 항상 올바르게 전송되지 않기 때문에, 데이터가 손상되거나 유실되었을 때 일련번호와 확인 응답 번호를 사용하여 재전송.

	• 윈도우 크기
		○ TCP는 매 세그먼트마다 확인 요청을 하므로, 하나씩 전송할 경우 효율성이 낮음.
			§ 응답 대기하는 지연시간.
			§ 반면, 세그먼트를 연속적으로 보낸 후 확인 응답을 할 경우 효율이 높아짐.
			§ 연속적으로 전송한 세그먼트가 쌓이지 않게끔 버퍼를 사용하므로 수신 측에서 연속 세그먼트에 대한 대응을 할 수 있음.
			§ 그러나 버퍼의 크기 이상으로 대량으로 수신할 경우 Overflow발생.
			§ 따라서 overflow가 발생하지 않게끔 버퍼의 한계 크기를 알아야 하는데, 이 내용이 window size(TCP Header 데이터 중 하나)값에 해당.
		○ Window Size는 얼마나 많은 용량의 데이터를 버퍼에 저장해 둘 수 있는지를 나타냄.
			§ 해당 사이즈는 초기 3 - way Handshake를 할 때 판단.
			§ 즉 SYN , ACK + SYN, ACK 시그널을 교환하는 과정에서 윈도우 크기 값도 함께 전송.
			§ 각 컴퓨터의 window size를 알게 되면 크기에 맞춰서 세그먼트를 연속적으로 전송할 수 있게 됨.

	26. 포트 번호의 구조
	• 데이터의 목적지가 어떤 프로그램인지 구분하는 역할을 하는 포트 번호에 대해 파악.
	• 전송 계층의 TCP는 전송된 데이터의 목적지가 어떤 애플리케이션(앱, 브라우저, 메일 프로그램 등)인지 구분하는 역할.
		○ 목적지의 애플리케이션을 구분하지 못하면 해당 데이터는 무용지물.
		○ 위 일들이 발생하지 않도록 하기 위해 TCP Header에 출발지 포트 번호와 목적지 포트 번호가 필요.
	• 포트 번호를 이용하여 애플리케이션을 구분.
		○ Well-Known Ports : 0 ~ 1023번
		○ Reserved Port(NA): 1024번
		○ Random Ports        : 1025번 이상은 클라이언트 측의 송신 포트로 사용
		○ Well-known ports는 일반적으로 사용하는 서버 측의 애플리케이션에 사용.
			§ SSH(22), SMTP(25), DNS(53), HTTP(80), POP3(110), HTTPS(443)
		○ 결과적으로 데이터를 전송할 경우에는 IP Address, MAC Address가 필요하지만, 애플리케이션을 찾아가기 위해선 TCP에서 Port번호가 필요.
		○ 웹 브라우저로 접속할 때 브라우저에는 임의의 포트 번호가 할당됨. 따라서, 서버 측에서는 포트 번호를 정해야하지만, 클라이언트(브라우저) 측은 정하지 않아도 됨.

	27. UDP(User Datagram Protocol)의 구조
	• 전송 계층에서 효율적으로 통신할 수 있도록 돕는 UDP 프로토콜의 구조에 대한 이해.
	• 비연결형 통신 방법이므로 TCP처럼 신뢰성과 정확성을 위한 작업을 일일이 하지 않음.
	• 데이터를 효율적으로 빠르게 보내는 것이 핵심. 동영상과 같은 미디어를 UDP를 통해 통신.
	• UDP Header
		○ 전송하고자 하는 데이터에 UDP Header가 붙은 것을 UDP Datagram이라고 지칭.
		○ UDP Header의 구성 : 출발지 포트 번호, 목적지 포트 번호, 길이, Checksum
		○ 올바른 목적지의 애플리케이션을 데이터를 전송하기 위한 필요한 정보가 기록되어 있음.
	• UDP Datagram(혹은 UDP Segment)의 경우 전송할 때 연속적으로 전송.
		○ 따라서 broadcasting할 때는 UDP가 적합.
		○ TCP는 목적지를 지정해야 하므로 broadcasting에 적합하지 않음.
